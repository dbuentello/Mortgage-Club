<h2 class="auth-form-heading">Sign up</h2>

<%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>
  <%= devise_error_messages! %>

  <%= hidden_field_tag :invite_token, nil %>
  <%= hidden_field_tag :ref_code, nil %>

  <div class="field">
    <%= f.label :first_name %><br>
    <%= f.text_field :first_name, class: "form-control", autofocus: true %>
  </div>
  <div class="field">
    <%= f.label :last_name %><br>
    <%= f.text_field :last_name, class: "form-control" %>
  </div>

  <div class="field">
    <%= f.label :email %><br />
    <%= f.email_field :email, class: "form-control" %>
  </div>

  <div class="field">
    <%= f.label :password %>
    <% if @minimum_password_length %>
    <em>(<%= @minimum_password_length %> characters minimum)</em>
    <% end %><br />
    <%= f.password_field :password, autocomplete: "off", class: "form-control" %>
  </div>

  <div class="field">
    <%= f.label :password_confirmation %><br />
    <%= f.password_field :password_confirmation, autocomplete: "off", class: "form-control" %>
  </div>

  <div class="field">
    <label>Your Role</label>
    <%= select_tag(:role, options_for_select([["Loan's owner", "loan-owner"], ["Loan's team member", "loan-team-member"]], "loan-owner"), class: "form-control") %>
  </div>

  <div class="actions">
    <%= f.submit "Sign up", class: "btn btn-lg btn-primary btn-block" %>
  </div>
<% end %>

<%= render "devise/shared/links" %>

<script type="text/javascript">
  // Set cookie invite token value
  <% if !@token.nil? %>
    document.cookie="_refToken=<%= @token %>";
  <% end %>

  // Set invite token value
  var ref_token = getCookie('_refToken');
  if (ref_token != null) {
    document.getElementById("invite_token").setAttribute('value', ref_token);
  }

  // Set refCode value
  var ref_code = getCookie('_refcode');
  if (ref_code != null) {
    document.getElementById("ref_code").setAttribute('value', ref_code);
  }

  // Get cookie value
  function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
  }
</script>
